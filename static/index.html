<!DOCTYPE html>
<html>
    <head>
        <title>Virtual Aquarium</title>
        <link rel="stylesheet" href="fish.css" type="text/css">
    </head>
    <body>
    
		<canvas id="view">No Support for canvas!</canvas>
		
        <script type="text/javascript" src="jim.js"></script>
		<script type="text/javascript" src="hunter.js"></script>
        
		<script type="text/javascript">			
			
			var frame = 0;
            var waterFrame = 0;
			function main() {
				view.clear();
                

                for (var i in Water.all) {
					Water.all[i].render(view.ctx);
				}

                aquarium.render(view.ctx);
                
                frame = (frame + 1) % Fish.frames;
                for (var i in Fish.all) {
					Fish.all[i].render(view.ctx, frame);
				}
                
                for (var i in Bubbles.all) {
					var bubble = Bubbles.all[i]
                    if (bubble.l > bubble.d) {
                        Bubbles.all.splice(i, 1)
                    } else {
                        bubble.render(view.ctx);
                    }
                    
				}
			}

			// Found out the fastest way to clear an element is blank space; we may need 2 large canvases:
			// 1 - for the main action in front
			// 2 - for the background (water, aquarium, etc)
			
			view = new View('view');			
			var view, aquarium;
	        
	        aquarium = new Aquarium(view.canvas.width, view.canvas.height);
	        aquarium.prepare();
            
            // frames, x offset, y offset, wave height, wave length
			new Water(50, -13, 30, 15, 55);
            new Water(45, -13, 32, 10, 50);
                        
			//for (var x = 0; x < 5; x++) {
			//	for (var y = 0; y < 3; y++) {
			//		var fish = new Fish(50 + 200 * x, 50 + 150 * y, 120, 100);
			//	}
			//}
            
            //new Fish(250, 200, 150, 100);
            new Fish(110, 323, 120, 100);
            //new Fish(95, 500, 200, 110);
            new Fish(185, 100, 80, 50);
            
            //new Bubbles(200, 200, 4, 100);
            //new Bubbles(200, 220, 4, 100);
            //new Bubbles(200, 240, 4, 100);
            
            
			window.onresize = function() {
				view.resize(window.innerWidth || document.documentElement.clientWidth, window.innerHeight || document.documentElement.clientHeight);				
			}
	 
			window.onresize();
			
			setInterval(main, 1000 / 25);

		</script>

	</body>
</html>