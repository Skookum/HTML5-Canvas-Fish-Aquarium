function View(b){this.canvas=document.getElementById(b);this.ctx=this.canvas.getContext("2d");document.getElementById("view")}View.prototype.resize=function(b,a){this.canvas.width=b;this.canvas.height=a};View.prototype.clear=function(){this.canvas.width=this.canvas.width};function Fish(b,a,c,d){this.x=b;this.y=a;this.w=c;this.h=d;this.s=rand(0,3);this.d=1;this.vertDir=0;this.test=true;this.canvas=[];this._fingerprint();for(b=0;b<Fish.frames;b++)this.prepare(b);Fish.all.push(this)}Fish.frames=20; Fish.all=[]; Fish.prototype._fingerprint=function(){this.fins=[];this.fingerprint={nx:this.w-10,ny:this.h*0.5,fb:this.w*rand(0.3,0.75),rb:this.w*rand(0.15,0.25),f:this.h*rand(0,0.35),px:10,pt:this.h*rand(0.25,0.75),tc:this.h*rand(0,0.4),td:this.w*rand(0,0.2),grad:~~rand(0,5),fins:[]};for(var b=this.w-this.fingerprint.rb,a=~~rand(0,5);a>0;a--)this.fingerprint.fins.push({s:this.w-b*rand(0.1,0.3),y:this.h*rand(0,1),l:b*rand(0.2,0.5)});this.fingerprint.eye={h:this.h*rand(0.04,0.15),x:this.w*0.8,s:this.h*rand(0.05, 0.1)};this.fingerprint.pupil={s:this.fingerprint.eye.s*rand(0.5,0.8),a:rand(0,Math.PI*2)};this.fingerprint.pupil.o=(this.fingerprint.eye.s-this.fingerprint.pupil.s)*rand(0.2,0.5)}; Fish.prototype._draw_shape=function(b,a,c,d){var f=Math.PI*2/Fish.frames*d,e=this.w*0.1;d=[c.px+e*Math.cos(f),c.pt];f=[c.px+e*Math.cos(f+Math.PI*0.5),b.height-c.pt];a.fillStyle="#fff";a.beginPath();a.moveTo(c.nx,c.ny);a.bezierCurveTo(c.fb,b.height+c.f,c.rb,b.height*0.15,d[0],d[1]);a.bezierCurveTo(c.td,b.height*0.5-c.tc,c.td,b.height*0.5+c.tc,f[0],f[1]);a.bezierCurveTo(c.rb,b.height-b.height*0.15,c.fb,-c.f,c.nx,c.ny);a.fill()}; Fish.prototype._draw_fins=function(b,a,c,d){d=this.w*0.025*Math.cos(Math.PI*2/Fish.frames*d);a.globalCompositeOperation="destination-over";for(var f in c.fins){var e=c.fins[f],g=a.createLinearGradient(0.5*b.width,0,0.5*b.width,b.height);g.addColorStop(0,"rgba(255,255,255,.25)");g.addColorStop(0.5,"rgba(255,255,255,.1)");g.addColorStop(1,"rgba(255,255,255,.5)");a.fillStyle=g;a.beginPath();a.moveTo(e.s,b.height*0.5);a.quadraticCurveTo(e.s-e.l*0.5,e.y,e.s-e.l*1.35-d,e.y);a.lineTo(e.s-e.l,b.height*0.5); a.fill()}a.globalCompositeOperation="source-over"}; Fish.prototype._draw_scales=function(b,a){var c=document.createElement("canvas"),d=c.getContext("2d");c.width=b.width;c.height=b.height;d.strokeStyle="#000";for(var f=0;f<c.width*2/11;f+=1)for(var e=0;e<c.height/11;e+=1){circle(d,f*11*0.5,e*11+5.5*(f%2),4.5);glow(d,3,"#000");var g=1-Math.abs(e*11-c.height*0.5)/(c.height*0.5)*1.25;g*=(1-Math.abs(f*11*0.5-c.width*0.6)/(c.width*0.7))*1.25;d.fillStyle="rgba(255,255,255,"+g+")";d.fill()}a.globalCompositeOperation="source-atop";a.drawImage(c,0,0,c.width, c.height);a.globalCompositeOperation="source-over"}; Fish.prototype._draw_colors=function(b,a,c){var d=[];d[0]=a.createRadialGradient(0.64*b.width,0.45*b.height,b.width*0.1,0.5*b.width,0.5*b.height,b.width*0.8);d[0].addColorStop(0,"rgba(255,204,0,.7)");d[0].addColorStop(0.25,"rgba(230, 152, 0, .9)");d[0].addColorStop(0.8,"rgba(146,62,0,1)");d[1]=a.createRadialGradient(0.64*b.width,0.7*b.height,b.width*0.1,0.5*b.width,0.5*b.height,b.width*0.8);d[1].addColorStop(0.6,"rgba(129,153,33,.9)");d[1].addColorStop(0.45,"rgba(252,229,127,1)");d[1].addColorStop(0.3, "rgba(232,135,20,.8)");d[1].addColorStop(0,"rgba(67,106,103,1)");d[2]=a.createLinearGradient(0,b.height*0.45,b.width,b.height);d[2].addColorStop(0.3,"rgba(254,186,18,.9)");d[2].addColorStop(0.32,"rgba(0, 0, 0, .7)");d[2].addColorStop(0.35,"rgba(255,255,255,.9)");d[2].addColorStop(0.43,"rgba(255,255,255,.9)");d[2].addColorStop(0.45,"rgba(0,0,0,.7)");d[2].addColorStop(0.47,"rgba(254,186,18,.9)");d[2].addColorStop(0.55,"rgba(254,186,18,.9)");d[2].addColorStop(0.57,"rgba(0, 0, 0, .7)");d[2].addColorStop(0.6, "rgba(255, 255, 255, .9)");d[2].addColorStop(0.62,"rgba(255, 255, 255, .9)");d[2].addColorStop(0.64,"rgba(0, 0, 0, .7)");d[2].addColorStop(0.66,"rgba(254, 186, 18, .9)");d[3]=a.createRadialGradient(0.8*b.width,b.height,b.width*0.1,0.8*b.width,b.height,b.width*0.8);d[3].addColorStop(0,"rgba(255,255,255,.9)");d[3].addColorStop(0.65,"rgba(128, 128, 128, .9)");d[3].addColorStop(0.7,"rgba(0,0,0,.7)");d[3].addColorStop(0.75,"rgba(255, 255, 255, .5)");d[3].addColorStop(0.8,"rgba(255, 255, 255, .5)");d[3].addColorStop(0.95, "rgba(128, 128, 128, .8)");d[4]=a.createRadialGradient(0.8*b.width,0.5*b.height,b.width*0.1,0.8*b.width,0.5*b.height,b.width*0.6);d[4].addColorStop(0.3,"rgba(200,0,0,.9)");d[4].addColorStop(0.4,"rgba(255, 100, 0, .8)");d[4].addColorStop(0.75,"rgba(255, 0, 0,.9)");d[4].addColorStop(1,"rgba(200, 0, 0, .7)");a.globalAlpha=0.9;a.globalCompositeOperation="source-atop";a.fillStyle=d[c.grad];a.fillRect(0,0,b.width,b.height);a.globalAlpha=1}; Fish.prototype._draw_eye=function(b,a,c){var d=a.createRadialGradient(c.eye.x,b.height*0.5-c.eye.h,0,c.eye.x,b.height*0.5-c.eye.h,c.eye.s);d.addColorStop(0.7,"rgba(255,255,255,1)");d.addColorStop(1,"rgba(255,255,255,.5)");a.fillStyle=d;circle(a,c.eye.x,b.height*0.5-c.eye.h,c.eye.s);glow(a,5,"rgba(0,0,0,.7)");a.fill();glow(a,0,"");a.fillStyle="#000000";circle(a,c.eye.x+Math.cos(c.pupil.a)*c.pupil.o,b.height*0.5-c.eye.h+Math.sin(c.pupil.a)*c.pupil.o,c.pupil.s);a.fill()}; Fish.prototype._draw_glow=function(b,a,c,d){a.globalCompositeOperation="destination-over";glow(a,30,"rgba(255,255,255,0.35)");this._draw_shape(b,a,c,d);a.globalCompositeOperation="source-over"}; Fish.prototype.prepare=function(b){this.canvas[b]=document.createElement("canvas");this.canvas[b].width=this.w;this.canvas[b].height=this.h;var a=this.canvas[b],c=a.getContext("2d"),d=this.fingerprint;this._draw_shape(a,c,d,b);this._draw_scales(a,c,d);this._draw_colors(a,c,d);this._draw_fins(a,c,d,b);this._draw_eye(a,c,d);this._draw_glow(a,c,d,b)}; Fish.prototype.render=function(b,a){var c=this.canvas[a];if(this.x>=view.canvas.width-c.width-10){this.d=this.d==1?0:1;this.x=10}if(this.s<1)this.s=1;if(this.s>5)this.s=3;this.x+=this.s;if(a==2){this.vertDir=this.y>50&&this.y<view.canvas.height-150?rand(-1,1):this.y<50?2:-2;if(rand(-1,1)>0)this.s=rand(this.s-1,this.s+1);if(rand(-1,15)<0){this.d=this.d==1?0:1;this.x=view.canvas.width-this.x-c.width}}this.y+=this.vertDir;b.save();if(!this.d){b.translate(view.canvas.width,1);b.scale(-1,1)}b.drawImage(c, this.x,this.y);b.restore()};function rand(b,a){return Math.random()*(a-b)+b}function circle(b,a,c,d){b.beginPath();b.arc(a,c,d,0,Math.PI*2,false)}function glow(b,a,c){b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=a;b.shadowColor=c}function Aquarium(b,a){this.canvas=document.createElement("canvas");this.canvas.width=b;this.canvas.height=a} Aquarium.prototype.prepare=function(){for(var b=this.canvas,a=b.getContext("2d"),c=0;c<b.width*10;c++){var d=rand(0,b.width),f=rand(b.height-80,b.height-10),e=rand(2,4),g=a.createRadialGradient(d,f,0,d,f,e),h="rgba("+Math.ceil(rand(90,110))+","+Math.ceil(rand(50,70))+",00,1)",i="rgba("+Math.ceil(rand(34,54))+","+Math.ceil(rand(27,47))+","+Math.ceil(rand(19,39))+",1)";g.addColorStop(0.4,h);g.addColorStop(1,i);a.fillStyle=g;circle(a,d,f,e);a.fill();a.lineWidth=1;a.strokeStyle="#2f251c";a.stroke()}a.strokeStyle= "#666";a.lineWidth=15;a.beginPath();a.moveTo(0,7.5);a.lineTo(b.width-a.lineWidth/2,7.5);a.lineTo(b.width-a.lineWidth/2,b.height-a.lineWidth/2);a.lineTo(a.lineWidth/2,b.height-a.lineWidth/2);a.lineTo(a.lineWidth/2,7.5-a.lineWidth);a.stroke();a.globalCompositeOperation="source-atop";g=a.createLinearGradient(0.5*b.width,0,0.5*b.width,b.height);g.addColorStop(0,"rgba(255,255,255,.0)");g.addColorStop(0.2,"rgba(255,255,255,.2)");g.addColorStop(0.3,"rgba(255,255,255,.75)");g.addColorStop(0.4,"rgba(255,255,255,.3)"); g.addColorStop(1,"rgba(255,255,255,0)");a.fillStyle=g;a.fillRect(0,0,b.width,b.height)};Aquarium.prototype.render=function(b){var a=this.canvas;b.drawImage(a,0,0,a.width,a.height)};function Water(b,a,c,d,f){this.canvas=document.createElement("canvas");this.canvas.width=view.canvas.width;this.canvas.height=view.canvas.height;this.f=b;this.x=a;this.y=c;this.h=d;this.w=f;this.m=0;this.p=a;this.prepare();Water.all.push(this)}Water.all=[]; Water.prototype._draw_water=function(b,a){a.strokeStyle="#61afef";a.lineWidth=3;for(var c=this.x;c<b.width;c+=this.w){a.moveTo(c,this.y);a.bezierCurveTo(c+this.w*0.2,this.y+this.h,c+this.w*0.8,this.y+this.h,c+this.w,this.y)}a.lineTo(b.width,b.height);a.lineTo(0,b.height);a.lineTo(0,this.y);a.stroke();c=a.createLinearGradient(0.5*b.width,0,0.5*b.width,b.height);c.addColorStop(0,"#67c1e9");c.addColorStop(0.04,"#65c1e9");c.addColorStop(0.5,"#7dcbec");c.addColorStop(1,"#2d95ea");a.fillStyle=c;a.fill(); a.globalCompositeOperation="destination-over"};Water.prototype.prepare=function(){var b=this.canvas,a=b.getContext("2d");this._draw_water(b,a)};Water.prototype.render=function(b){var a=this.canvas;if(this.m>this.f)this.m=0;this.p=this.m>this.f/2?this.m-(this.m-this.f/2)*2+this.x:this.m+this.x;this.m++;b.drawImage(a,this.p,0,a.width,a.height)}; function Bubbles(b,a,c,d){this.canvas=document.createElement("canvas");this.canvas.width=view.canvas.width;this.canvas.height=view.canvas.height;this.x=b;this.y=a;this.s=rand(c*0.7,c*1.5);this.l=0;this.d=rand(d*0.8,d*1.2);this.prepare();Bubbles.all.push(this)}Bubbles.all=[];Bubbles.prototype._draw_bubble=function(b,a){a.globalAlpha=0.4;circle(a,this.s+5,this.s+5,this.s);a.fillStyle="#FFF";a.fill();a.strokeStyle="#999";a.lineWidth=1;a.stroke();glow(a,1,"#FFF")}; Bubbles.prototype.prepare=function(){var b=this.canvas,a=b.getContext("2d");this._draw_bubble(b,a)};Bubbles.prototype.render=function(b){var a=this.canvas;this.l++;this.y=rand(this.y-1,this.y-3);this.x=rand(this.x-1,this.x+1);b.drawImage(a,this.x,this.y)};
